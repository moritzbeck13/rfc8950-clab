!
hostname {{ .ShortName }}
!
username clab
 group root-lr
 group cisco-support
 secret clab@123
!
grpc
{{ if .Env.CLAB_MGMT_VRF }} vrf {{ .Env.CLAB_MGMT_VRF }}{{end}}
 port 9339
 no-tls
 address-family dual
!
{{- if .Env.CLAB_MGMT_VRF }}
vrf {{ .Env.CLAB_MGMT_VRF }}
 address-family ipv4 unicast
 !
 address-family ipv6 unicast
 !
{{- end}}
!
line default
  transport input ssh
!
netconf-yang agent
 ssh
!
interface MgmtEth0/RP0/CPU0/0
{{ if .Env.CLAB_MGMT_VRF }} vrf {{ .Env.CLAB_MGMT_VRF }}{{end}}
!
router static
{{ if .Env.CLAB_MGMT_VRF }} vrf {{ .Env.CLAB_MGMT_VRF }}{{end}}
{{- if .MgmtIPv4Gateway }}
 address-family ipv4 unicast
  0.0.0.0/0 MgmtEth0/RP0/CPU0/0 {{ .MgmtIPv4Gateway }}
  !
{{- end}}
{{- if .MgmtIPv6Gateway }}
 address-family ipv6 unicast
  ::/0 MgmtEth0/RP0/CPU0/0 {{ .MgmtIPv6Gateway }}
  !
{{- end}}
!
ssh server v2
{{- if .Env.CLAB_MGMT_VRF }}
ssh server vrf {{ .Env.CLAB_MGMT_VRF }}
{{- end}}
ssh server netconf {{ if .Env.CLAB_MGMT_VRF }} vrf {{ .Env.CLAB_MGMT_VRF }}{{end}}

ipv4 access-list rs_protection_v4
 10 permit icmp 80.81.192.0/21 80.81.192.0/21
 30 permit tcp 80.81.192.0/21 eq bgp 80.81.192.0/21
 31 permit tcp 80.81.192.0/21 80.81.192.0/21 eq bgp
 40 permit udp 80.81.192.0/21 eq bfd 80.81.192.0/21
 41 permit udp 80.81.192.0/21 80.81.192.0/21 eq bfd
 50 deny ipv4 any any

ipv6 access-list rs_protection_v6
 10 permit icmpv6 2001:7f8::/64 2001:7f8::/64
 11 permit icmpv6 2001:7f8::/64 fe80::/10
 12 permit icmpv6 2001:7f8::/64 ff00::/8
 20 permit icmpv6 fe80::/10 2001:7f8::/64
 21 permit icmpv6 fe80::/10 fe80::/10
 22 permit icmpv6 fe80::/10 ff00::/8
 30 permit tcp 2001:7f8::/64 eq bgp 2001:7f8::/64
 31 permit tcp 2001:7f8::/64 2001:7f8::/64 eq bgp
 40 permit udp 2001:7f8::/64 eq bfd 2001:7f8::/64
 41 permit udp 2001:7f8::/64 2001:7f8::/64 eq bfd
 50 deny ipv6 any any

interface Loopback0
 description $LOOPBACK_NAME_interface
$LOOPBACK_INTERFACES

interface GigabitEthernet0/0/0/1
 description $PEERING_LAN_NAME_interface
$PEERING_LAN_INTERFACES

interface GigabitEthernet0/0/0/2
 description $CLIENT_LAN_NAME_interface
$CLIENT_LAN_INTERFACES

route-policy default_accept_route_policy
  done
end-policy

router bgp $BGP_ASN
 bgp router-id $BGP_ROUTER_ID
 address-family ipv4 unicast
  network $CLIENT_LAN_IPV4_NETWORK_ADDRESS/$CLIENT_LAN_IPV4_PREFIX_LENGTH
 
 address-family ipv6 unicast
  network $CLIENT_LAN_IPV6_NETWORK_ADDRESS/$CLIENT_LAN_IPV6_PREFIX_LENGTH
 
 neighbor-group $BGP_GROUP_NAME_group
  address-family ipv4 unicast
   route-policy default_accept_route_policy in
   route-policy default_accept_route_policy out
  
  address-family ipv6 unicast
   route-policy default_accept_route_policy in
   route-policy default_accept_route_policy out
  
 
$BGP_NEIGHBORS

end